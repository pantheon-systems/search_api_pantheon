# https://circleci.com/docs/configuration#machine
machine:
  php:
    # https://circleci.com/docs/environment#php
    version: 5.6.22
  environment:
    # DB config. Using default CircleCI's database.
    TERMINUS_ENV: ci-$CIRCLE_BUILD_NUM
    TERMINUS_SITE: search-api-solr-d8

dependencies:
  cache_directories:
    - ~/.composer/cache
  post:
    - terminus auth login --machine-token=$TERMINUS_TOKEN
    # Make a new multidev env from a vanilla D8 site.
    - cd tests/circle-scripts && ./create-fresh-d8-site.sh
test:
  pre:
    # Set up the D8 site with contrib migrate contrib modules and enable
    # those modules on Panetheon.
    - cd tests/circle-scripts && ./setup-d8-repo.sh

    # Configure the migration, creating exportable, re-runnable configuration.
    - cd tests/circle-scripts && ./enable-modules.sh
  override:
    - cd tests/circle-scripts && ./verify-solr.sh
